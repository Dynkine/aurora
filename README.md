# Setting up Jenkins server

- ## Prerequisites
    - ### Setting up connection between Github and local Jenkins installation
        
        To get Github webhooks working we need to create a connection between internet (Github server) and Jenkins server that is deployed locally and doesn’t have public IP address or DNS record. In order to solve this issue I would use the tool called [ngrok](https://ngrok.com/). It allows to create a tunnel between Github server and our local Jenkins installation. 
         I’ve already created an agent for my installation so you can use mine auth-token. To use ngrok please do the following. Alternatively you can register and get your personal token.
        
        ```bash
        #Install ngrok
        [https://ngrok.com/download](https://ngrok.com/download)
        # authenticate
        ngrok config add-authtoken 2GCxEcxZVg0c2ytTC9q5HpM0rgf_6ckcgVG1eCmhMTAp84JuN
        # start ngrok pointing to local Jenkins at port 8080
        ngrok http 8080 > /dev/null &
        # you can find an external host address at
        http://localhost:4040
        # or if you logged in use ngrok dashboard
        https://dashboard.ngrok.com/tunnels/agents
        ```
        
    - ### GitHub webhook configuration
        
        I’ve already set up the [webhook](https://github.com/Dynkine/aurora/settings/hooks/384275738) in my repo. In case you’d like to create a new one please use the external host address generated by ngrok
        
        ```bash
        https://8be9-2a0d-6fc2-10f8-db00-401f-982d-6baa-bf22.eu.ngrok.io/github-webhook/
        ```
        
    - ### Exporting env variables
        
        I use a number of secrets that I provide as env vars: jenkins admin password, agent ssh keys and  github token. You have to set up these env vars in your environment. 
        
        ```bash
        # Create ssh key pair for Jenkins agent
        ssh-keygen -t rsa -f jenkins_agent
        # Export env vars
        export EXPORTED_JENKINS_AGENT_PRIVATE_SSH_KEY=$(cat ~/.ssh/jenkins_agent)
        export EXPORTED_JENKINS_ADMIN_PASSWORD=your_jenkins_admin_password
        export EXPORTED_GITHUB_TOKEN=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
        export EXPORTED_JENKINS_AGENT_SSH_PUBKEY=$(cat ~/.ssh/jenkins_agent.pub)
        ```
        
- ## Start the server
    ### Clone the repository
    
    ```bash
    git clone https://github.com/Dynkine/aurora.git
    ```
    
    ### Navigate to the the cloned repo
    
    ```bash
    cd aurora/
    ```
    
    ### Start the Jenkins server
    
    ```bash
    docker-compose up -d
    ```
